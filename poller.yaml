functions:
- id: nutanix
  image: gcr.io/direktiv/functions/nutanix:1.0
  type: knative-workflow

states:

# changes the IP from old to new
# it fails automatically after 30 seconds 
# because the connection is broken after changing the IP
- id: token 
  type: action
  log: fetching move token
  action:
    function: nutanix
    secrets: ["movepwd"]
    input: 
      auth:
        host: https://10.32.160.40
        skipVerify: true
      api:
        path: "/move/v2/users/login"
        method: POST
        body: 
          Spec:
            UserName: nutanix
            Password: jq(.secrets.movepwd)
  transform:
    token: jq(.return.nutanix.Status.Token)
  transition: fetch-events

- id: fetch-events 
  type: action
  log: fetching move events with token jq(.token)
  action:
    function: nutanix
    input: 
      auth:
        host: https://10.32.160.40
        skipVerify: true
        token: jq(.token)
      api:
        path: "/move/v2/events"
        method: POST
        body: 
          Filter:
            EventNames:
            - Initiate Cutover
          PaginationCriteria:
            PageNumber: 1
            RecordsPerPage: 100
 

